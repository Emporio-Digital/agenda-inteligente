// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") 
  directUrl = env("POSTGRES_URL_NON_POOLING") 
}

// üè¢ O CLIENTE DO SAAS
model Tenant {
  id             String   @id @default(uuid())
  name           String
  slug           String   @unique
  planTier       String   @default("SOLO")
  createdAt      DateTime @default(now())
  
  primaryColor   String   @default("#000000") 
  secondaryColor String   @default("#ffffff")
  logoUrl        String?
  coverUrl       String?
  
  // --- NOVOS CAMPOS ADICIONADOS ---
  phone          String?  // WhatsApp do Estabelecimento
  address        String?  // Endere√ßo (para evitar erros na page publica)
  // -------------------------------

  themeVariant   String   @default("BARBER")

  stripeCustomerId   String?
  subscriptionStatus String? 

  services       Service[]
  professionals  Professional[]
  customers      Customer[]
  appointments   Appointment[]
  users          User[]
}

// üë§ USU√ÅRIOS (LOGIN)
model User {
  id            String    @id @default(uuid())
  name          String?
  email         String    @unique
  password      String    
  role          String    @default("ADMIN") 
  
  tenantId      String
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime  @default(now())
}

// üíá‚Äç‚ôÇÔ∏è PROFISSIONAIS
model Professional {
  id            String   @id @default(uuid())
  name          String
  photoUrl      String?
  isActive      Boolean  @default(true)
  
  workStart     String   @default("09:00")
  workEnd       String   @default("18:00")
  lunchStart    String?  @default("12:00")
  lunchEnd      String?  @default("13:00")
  
  // NOVA COLUNA: Dias de Trabalho (0=Dom, 1=Seg, ..., 6=Sab)
  // Default: Seg(1) a Sab(6)
  workDays      String   @default("1,2,3,4,5,6")

  workHours     Json?    

  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id])
  appointments  Appointment[]
  
  // VINCULO NOVO: O Profissional tem SEUS servi√ßos
  services      Service[] 
}

// ‚úÇÔ∏è SERVI√áOS (Agora vinculados ao Profissional)
model Service {
  id             String   @id @default(uuid())
  name           String
  price          Decimal
  durationMin    Int
  description    String?
  
  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id])
  
  // VINCULO NOVO
  professionalId String?  
  professional   Professional? @relation(fields: [professionalId], references: [id])
  
  appointments   Appointment[] 
}

// üìÖ AGENDAMENTOS
model Appointment {
  id             String   @id @default(uuid())
  date           DateTime 
  status         String   @default("SCHEDULED") 
  createdAt      DateTime @default(now())

  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id])
  
  professionalId String
  professional   Professional @relation(fields: [professionalId], references: [id])
  
  customerId     String
  customer       Customer @relation(fields: [customerId], references: [id])
  
  services       Service[]
}

// üë§ CLIENTE FINAL
model Customer {
  id        String   @id @default(uuid())
  name      String
  phone     String
  tenantId  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id])
  appointments Appointment[]
}