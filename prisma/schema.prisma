generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  // Mantive suas vari√°veis originais da Vercel
  url       = env("POSTGRES_PRISMA_URL") 
  directUrl = env("POSTGRES_URL_NON_POOLING") 
}

// üè¢ O CLIENTE DO SAAS (A Barbearia/Sal√£o)
model Tenant {
  id             String   @id @default(uuid())
  name           String
  slug           String   @unique
  planTier       String   @default("SOLO") // SOLO, PRO
  createdAt      DateTime @default(now())
  
  // Configura√ß√µes Visuais
  primaryColor   String   @default("#000000") 
  secondaryColor String   @default("#ffffff")
  logoUrl        String?
  coverUrl       String?
  themeVariant   String   @default("BARBER")

  // --- NOVOS CAMPOS (PAGAMENTO STRIPE) ---
  stripeCustomerId   String?
  subscriptionStatus String? // ACTIVE, PAST_DUE, CANCELED
  // ----------------------------------------

  services       Service[]
  professionals  Professional[]
  customers      Customer[]
  appointments   Appointment[]
  
  // Rela√ß√£o com Usu√°rios (Login)
  users          User[]
}

// üë§ USU√ÅRIOS DO SISTEMA (LOGIN DO DONO) - NOVO MODEL
model User {
  id            String    @id @default(uuid())
  name          String?
  email         String    @unique
  password      String    // Senha hash (Bcrypt)
  role          String    @default("ADMIN") // ADMIN, STAFF
  
  tenantId      String
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime  @default(now())
}

// üíá‚Äç‚ôÇÔ∏è OS PROFISSIONAIS
model Professional {
  id            String   @id @default(uuid())
  name          String
  photoUrl      String?
  isActive      Boolean  @default(true)
  
  // --- NOVOS CAMPOS (HOR√ÅRIOS DE TRABALHO) ---
  // Adicionamos como String simples para facilitar a edi√ß√£o no painel
  workStart     String   @default("09:00")
  workEnd       String   @default("18:00")
  lunchStart    String?  @default("12:00")
  lunchEnd      String?  @default("13:00")
  workDays      String   @default("1,2,3,4,5,6") // 0=Dom, 1=Seg...
  // -------------------------------------------

  workHours     Json?    // Mantive seu campo Json caso queira usar l√≥gica complexa no futuro

  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id])
  appointments  Appointment[]
}

// ‚úÇÔ∏è OS SERVI√áOS
model Service {
  id            String   @id @default(uuid())
  name          String
  price         Decimal
  durationMin   Int
  description   String?
  tenantId      String
  tenant        Tenant   @relation(fields: [tenantId], references: [id])
  
  appointments  Appointment[] 
}

// üìÖ OS AGENDAMENTOS
model Appointment {
  id             String   @id @default(uuid())
  date           DateTime
  status         String   @default("SCHEDULED") // SCHEDULED, CANCELED, COMPLETED
  
  // Adicionei createdAt para ordenar no Admin (Novos primeiro)
  createdAt      DateTime @default(now())

  tenantId       String
  tenant         Tenant   @relation(fields: [tenantId], references: [id])
  
  professionalId String
  professional   Professional @relation(fields: [professionalId], references: [id])
  
  customerId     String
  customer       Customer @relation(fields: [customerId], references: [id])
  
  services       Service[]
}

// üë§ O CLIENTE FINAL
model Customer {
  id        String   @id @default(uuid())
  name      String
  phone     String
  tenantId  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id])
  appointments Appointment[]
}